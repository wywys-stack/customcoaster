<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Custom Coasters — Designer</title>

  <style>
    :root{
      --bg: #fbf6ee;
      --ink:#1f1a15;
      --muted:#6b5f55;
      --card:#fffaf2;
      --line:#e7dccf;
      --shadow: 0 12px 28px rgba(31,26,21,.10);
      --accent:#c65a2e;
      --accent2:#1e6f5c;
      --chip:#f3e7d8;
      --focus: 0 0 0 3px rgba(198,90,46,.22);
      --radius: 18px;
      --radius2: 24px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--ink);
      background:
        radial-gradient(1100px 700px at 10% -10%, #ffe8cf 0%, transparent 60%),
        radial-gradient(900px 650px at 105% 0%, #d6f0ea 0%, transparent 55%),
        var(--bg);
    }

    header{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(8px);
      background: rgba(251,246,238,.78);
      border-bottom:1px solid var(--line);
    }
    .wrap{ max-width:1200px; margin:0 auto; padding: 16px 16px; }
    .brand{
      display:flex; align-items:center; gap:12px;
      justify-content:space-between;
    }
    .brand-left{ display:flex; align-items:center; gap:12px; }
    .mark{
      width:42px; height:42px; border-radius: 14px;
      background: linear-gradient(145deg, rgba(198,90,46,.95), rgba(30,111,92,.9));
      box-shadow: 0 10px 22px rgba(31,26,21,.12);
      position:relative;
    }
    .mark:after{
      content:"";
      position:absolute; inset:9px;
      border-radius: 12px;
      background: rgba(251,246,238,.65);
      transform: rotate(10deg);
    }
    h1{ font-size: 16px; letter-spacing:.2px; margin:0; }
    .sub{ margin:0; font-size: 12px; color: var(--muted); }

    .cta-mini{
      display:flex; gap:10px; align-items:center;
      font-size: 12px;
      color: var(--muted);
    }
    .pill{
      padding:8px 10px;
      border-radius: 999px;
      background: var(--chip);
      border: 1px solid var(--line);
      font-family: var(--mono);
    }

    main .wrap{
      padding: 18px 16px 36px;
      display:grid;
      grid-template-columns: 440px 1fr;
      gap: 18px;
      align-items:start;
    }
    @media (max-width: 980px){
      main .wrap{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card-head{
      padding: 14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap: 12px;
    }
    .card-head h2{ margin:0; font-size: 14px; letter-spacing:.2px; }
    .card-head .hint{ font-size: 12px; color: var(--muted); }
    .card-body{ padding: 14px 16px 16px; }

    .grid{ display:grid; gap: 12px; }
    label{
      font-size: 12px;
      color: var(--muted);
      display:block;
      margin-bottom: 6px;
    }

    select, input[type="text"], input[type="number"], input[type="range"]{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--ink);
      outline: none;
    }
    input[type="range"]{
      padding: 10px 10px;
      height: 42px;
    }
    select:focus, input:focus{ box-shadow: var(--focus); border-color: rgba(198,90,46,.55); }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .row3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    @media (max-width: 560px){
      .row2, .row3{ grid-template-columns: 1fr; }
    }

    .uploader{
      border: 1px dashed rgba(31,26,21,.25);
      background: rgba(255,255,255,.6);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
    }
    .uploader .meta{
      display:flex; flex-direction:column; gap:3px;
      min-width:0;
    }
    .uploader .meta b{
      font-size: 13px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .uploader .meta span{
      font-size: 12px; color: var(--muted);
    }

    .btn{
      appearance:none;
      border: 1px solid var(--line);
      background: #fff;
      color: var(--ink);
      border-radius: 999px;
      padding: 10px 12px;
      font-weight: 600;
      cursor:pointer;
      transition: transform .05s ease, box-shadow .2s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 20px rgba(31,26,21,.10); }
    .btn:active{ transform: translateY(0px); box-shadow:none; }
    .btn.primary{
      border-color: rgba(198,90,46,.4);
      background: linear-gradient(135deg, rgba(198,90,46,.95), rgba(198,90,46,.78));
      color: #fff;
    }
    .btn.ghost{ background: transparent; }
    .btn.danger{
      border-color: rgba(198,90,46,.25);
      background: rgba(198,90,46,.08);
      color: #6d2d17;
    }

    .chips{ display:flex; flex-wrap:wrap; gap: 8px; }
    .chip{
      display:flex; align-items:center; gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: #fff;
      cursor:pointer;
      font-size: 12px;
    }
    .chip input{ accent-color: var(--accent); }
    .swatch{
      width: 12px; height: 12px; border-radius: 999px;
      border:1px solid rgba(31,26,21,.18);
    }

    .divider{ height:1px; background: var(--line); margin: 12px 0; }

    .note{
      background: rgba(30,111,92,.08);
      border: 1px solid rgba(30,111,92,.18);
      padding: 10px 12px;
      border-radius: 16px;
      color: #164b3f;
      font-size: 12px;
      line-height: 1.35;
    }
    .warn{
      background: rgba(198,90,46,.08);
      border: 1px solid rgba(198,90,46,.18);
      color: #6d2d17;
    }

    /* Preview area */
    .preview{ display:grid; gap: 14px; }
    .stage{ padding: 16px; }
    .stage-top{
      display:flex; align-items:center; justify-content:space-between; gap: 12px;
      margin-bottom: 10px;
    }
    .stage-top .title{ display:flex; flex-direction:column; gap: 2px; }
    .stage-top .title b{ font-size: 14px; }
    .stage-top .title span{ font-size: 12px; color: var(--muted); }

    .canvas-shell{
      border-radius: 26px;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.25));
      padding: 14px;
    }
    .canvas-inner{
      display:grid;
      place-items:center;
      background: rgba(31,26,21,.04);
      border-radius: 20px;
      padding: 18px;
      overflow:hidden;
    }
    canvas{
      width:min(520px, 92vw);
      height:auto;
      display:block;
      border-radius: 18px;
      box-shadow: 0 16px 28px rgba(31,26,21,.14);
      background: #fff;
    }

    .stage-actions{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
      margin-top: 12px;
    }
    .stage-actions .left{
      display:flex; flex-wrap:wrap; gap: 10px;
      align-items:center;
    }
    .small{ font-size: 12px; color: var(--muted); }
    .mono{ font-family: var(--mono); }
    .sr{ position:absolute; left:-9999px; }

    .examples{ margin-top: 10px; display:grid; gap: 10px; }
    .thumbs{ display:flex; flex-wrap:wrap; gap: 10px; }
    .thumb{
      width: 74px; height: 74px;
      border-radius: 16px;
      border: 1px solid var(--line);
      background: #fff;
      display:grid; place-items:center;
      cursor:pointer;
      overflow:hidden;
      position:relative;
    }
    .thumb img{
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      padding: 8px;
      filter: grayscale(1) contrast(1.2);
    }
    .thumb:hover{ box-shadow: 0 10px 20px rgba(31,26,21,.12); transform: translateY(-1px); }

    .texture-list{
      display:grid;
      gap: 10px;
    }
    .tex-row{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items:center;
      padding: 10px;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: rgba(255,255,255,.55);
    }
    .tex-left{
      display:flex;
      gap: 10px;
      align-items:center;
      min-width:0;
    }
    .tex-thumb{
      width: 44px; height: 44px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: #fff;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .tex-thumb img{
      width:100%; height:100%;
      object-fit: cover;
      display:block;
    }
    .tex-meta{
      display:flex; flex-direction:column; gap: 2px;
      min-width:0;
    }
    .tex-meta b{ font-size: 13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .tex-meta span{ font-size: 12px; color: var(--muted); }

    .tex-actions{
      display:flex; gap: 8px; align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    details summary{
      cursor:pointer;
      user-select:none;
      list-style:none;
      font-size: 12px;
      color: var(--muted);
      padding: 10px 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.45);
      border-radius: 16px;
    }
    details summary::-webkit-details-marker{ display:none; }
    details[open] summary{ box-shadow: var(--focus); border-color: rgba(198,90,46,.35); }

    .minihelp{
      font-size: 11px;
      color: var(--muted);
      line-height: 1.3;
      margin-top: 8px;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="brand">
      <div class="brand-left">
        <div class="mark" aria-hidden="true"></div>
        <div>
          <h1>Custom Coasters</h1>
          <p class="sub">Shape · Material · Size · Upload logo · Add text · Pick fonts</p>
        </div>
      </div>
      <div class="cta-mini">
        <span class="pill">mid-century</span>
        <span class="pill">laser-preview</span>
        <span class="pill">1-page</span>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">

    <!-- Controls -->
    <section class="card">
      <div class="card-head">
        <h2>Design</h2>
        <div class="hint">Simple & customer-friendly</div>
      </div>

      <div class="card-body">
        <div class="grid">

          <div class="row2">
            <div>
              <label for="shape">Shape</label>
              <select id="shape">
                <option value="round">Round</option>
                <option value="square">Square</option>
                <option value="hex">Hex</option>
              </select>
            </div>
            <div>
              <label for="size">Size</label>
              <select id="size">
                <option value="3.5">3.5"</option>
                <option value="4.0" selected>4.0"</option>
                <option value="4.5">4.5"</option>
              </select>
            </div>
          </div>

          <div>
            <label>Material</label>
            <div class="chips" id="materials"></div>
          </div>

          <details>
            <summary>Material texture photos (optional)</summary>
            <div class="minihelp">
              Upload your real wood/slate photos here — great for showing customers what each material looks like.
              These images save in your browser (localStorage), so your “examples” stay put.
            </div>
            <div style="height:10px"></div>
            <div class="texture-list" id="textureList"></div>
            <div style="height:10px"></div>
            <div class="note">
              Tip: use square-ish photos (800×800+). Walnut grain photos look awesome behind the engraving.
            </div>
          </details>

          <div class="divider"></div>

          <!-- Upload logo/art -->
          <div>
            <label>Logo / Artwork overlay</label>

            <div class="uploader">
              <div class="meta">
                <b id="artName">No file selected</b>
                <span>SVG/PNG/JPG — preview auto “engraves” it</span>
              </div>
              <div>
                <input id="artFile" class="sr" type="file" accept="image/*,.svg" />
                <button class="btn" id="artPick">Upload</button>
              </div>
            </div>

            <div class="row2" style="margin-top:10px;">
              <div>
                <label for="logoPos">Logo placement</label>
                <select id="logoPos">
                  <option value="top">Top</option>
                  <option value="center" selected>Center</option>
                  <option value="bottom">Bottom</option>
                </select>
              </div>
              <div>
                <label for="logoScale">Logo scale <span class="small mono" id="logoScaleLabel">1.00×</span></label>
                <input id="logoScale" type="range" min="0.55" max="1.55" step="0.01" value="1.00"/>
              </div>
            </div>

            <div class="examples">
              <div class="small"><b>Example logos</b> (click to use) — you can add your own examples too.</div>
              <div class="thumbs" id="exampleThumbs"></div>

              <div class="uploader">
                <div class="meta">
                  <b>Upload example assets</b>
                  <span>Add sample logos so customers understand what “good files” look like.</span>
                </div>
                <div>
                  <input id="exampleFiles" class="sr" type="file" accept="image/*,.svg" multiple />
                  <button class="btn ghost" id="examplePick">Add examples</button>
                </div>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <!-- Text lines -->
          <div>
            <label>Text line 1</label>
            <div class="row3">
              <input id="t1Text" type="text" placeholder="e.g., WY WY MAKES" value="" />
              <select id="t1Font">
                <option value="Garamond, Georgia, serif">Classic Serif (Garamond)</option>
                <option value="'Palatino Linotype', Palatino, serif">Warm Serif (Palatino)</option>
                <option value="'Trebuchet MS', system-ui, sans-serif" selected>Modern Sans (Trebuchet)</option>
                <option value="system-ui, -apple-system, Segoe UI, Roboto, sans-serif">Clean Sans (System)</option>
                <option value="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace">Mono (Tech)</option>
              </select>
              <select id="t1Pos">
                <option value="top">Top</option>
                <option value="center" selected>Center</option>
                <option value="bottom">Bottom</option>
              </select>
            </div>
            <div style="height:10px"></div>
            <div class="row2">
              <div>
                <label for="t1Size">Line 1 size</label>
                <input id="t1Size" type="number" min="10" max="90" step="1" value="36" />
              </div>
              <div>
                <label>&nbsp;</label>
                <div class="note">
                  Keep line 1 short for best engraving.
                </div>
              </div>
            </div>
          </div>

          <div>
            <label>Text line 2</label>
            <div class="row3">
              <input id="t2Text" type="text" placeholder="e.g., EST. 2026 / CHULA VISTA" value="" />
              <select id="t2Font">
                <option value="Garamond, Georgia, serif">Classic Serif (Garamond)</option>
                <option value="'Palatino Linotype', Palatino, serif" selected>Warm Serif (Palatino)</option>
                <option value="'Trebuchet MS', system-ui, sans-serif">Modern Sans (Trebuchet)</option>
                <option value="system-ui, -apple-system, Segoe UI, Roboto, sans-serif">Clean Sans (System)</option>
                <option value="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace">Mono (Tech)</option>
              </select>
              <select id="t2Pos">
                <option value="top">Top</option>
                <option value="center">Center</option>
                <option value="bottom" selected>Bottom</option>
              </select>
            </div>
            <div style="height:10px"></div>
            <div class="row2">
              <div>
                <label for="t2Size">Line 2 size</label>
                <input id="t2Size" type="number" min="10" max="90" step="1" value="28" />
              </div>
              <div>
                <label>&nbsp;</label>
                <div class="note warn">
                  Tiny details may fade in real laser results.
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- Preview -->
    <section class="preview">
      <section class="card stage">
        <div class="stage-top">
          <div class="title">
            <b>Preview</b>
            <span>Laser-style engraving simulation (dark burn look)</span>
          </div>
          <div class="small mono" id="summary"></div>
        </div>

        <div class="canvas-shell">
          <div class="canvas-inner">
            <canvas id="cv" width="900" height="900" aria-label="Coaster preview"></canvas>
          </div>
        </div>

        <div class="stage-actions">
          <div class="left">
            <button class="btn primary" id="downloadPng">Download proof PNG</button>
            <button class="btn" id="copyCode">Copy design code</button>
          </div>
          <div class="small">
            Use the proof + code in your Big Cartel workflow.
          </div>
        </div>

        <div class="divider"></div>
        <div class="note">
          <b>Checkout:</b> after previewing here, customers upload the final file on your Big Cartel product page and pay.
          (This page keeps the experience clean + fast.)
        </div>
      </section>
    </section>

  </div>
</main>

<script>
  // -------------------------
  // Materials
  // -------------------------
  const MATERIALS = [
    { id:"birch",  name:"Birch",  tone:"#e7d2b3" },
    { id:"walnut", name:"Walnut", tone:"#6a4b34" },
    { id:"bamboo", name:"Bamboo", tone:"#d9c38f" },
    { id:"cork",   name:"Cork",   tone:"#c2a47a" },
    { id:"slate",  name:"Slate",  tone:"#4b4d52" }
  ];

  const KEYS = {
    examples: "coaster_examples_v2",
    textures: "coaster_material_textures_v1"
  };

  const $ = (id)=>document.getElementById(id);

  // Canvas
  const cv = $("cv");
  const ctx = cv.getContext("2d");

  // Controls
  const elShape = $("shape");
  const elSize  = $("size");
  const summary = $("summary");

  const artFile = $("artFile");
  const artPick = $("artPick");
  const artName = $("artName");
  const elLogoPos = $("logoPos");
  const elLogoScale = $("logoScale");
  const elLogoScaleLabel = $("logoScaleLabel");

  const exampleFiles = $("exampleFiles");
  const examplePick  = $("examplePick");
  const exampleThumbs= $("exampleThumbs");

  const textureList = $("textureList");

  // Text line controls
  const t1Text = $("t1Text");
  const t1Font = $("t1Font");
  const t1Pos  = $("t1Pos");
  const t1Size = $("t1Size");

  const t2Text = $("t2Text");
  const t2Font = $("t2Font");
  const t2Pos  = $("t2Pos");
  const t2Size = $("t2Size");

  // Actions
  const downloadPng = $("downloadPng");
  const copyCode    = $("copyCode");

  // State
  const state = {
    material: MATERIALS[0].id,
    shape: "round",
    size: 4.0,

    // logo
    artImage: null,
    artSrc: "",
    logoPos: "center",
    logoScale: 1.00,

    // text lines
    line1: { text:"", font: t1Font.value, pos:"center", size: 36 },
    line2: { text:"", font: t2Font.value, pos:"bottom", size: 28 },

    // textures
    textureMap: loadTextureMap(),      // { materialId: dataURL }
    textureImgCache: {}                // { materialId: Image() }
  };

  // -------------------------
  // Build material chips
  // -------------------------
  const materialsWrap = $("materials");
  MATERIALS.forEach((m, idx)=>{
    const lab = document.createElement("label");
    lab.className = "chip";
    lab.innerHTML = `
      <input type="radio" name="mat" value="${m.id}" ${idx===0?"checked":""} />
      <span class="swatch" style="background:${m.tone}"></span>
      <span>${m.name}</span>
    `;
    lab.addEventListener("change", ()=>{
      state.material = m.id;
      render();
    });
    materialsWrap.appendChild(lab);
  });

  // -------------------------
  // Example logos (built-in + user-added)
  // -------------------------
  const builtInExamples = [
    svgToDataURL(`<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 256 256">
      <rect width="256" height="256" fill="white"/>
      <path d="M60 170c25-75 40-95 68-95s43 20 68 95" fill="none" stroke="black" stroke-width="18" stroke-linecap="round"/>
      <path d="M88 150h80" stroke="black" stroke-width="16" stroke-linecap="round"/>
      <circle cx="128" cy="92" r="10" fill="black"/>
    </svg>`),
    svgToDataURL(`<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 256 256">
      <rect width="256" height="256" fill="white"/>
      <path d="M52 172l76-118 76 118H52z" fill="none" stroke="black" stroke-width="16" stroke-linejoin="round"/>
      <path d="M128 92v64" stroke="black" stroke-width="14" stroke-linecap="round"/>
      <circle cx="128" cy="172" r="7" fill="black"/>
    </svg>`),
    svgToDataURL(`<svg xmlns="http://www.w3.org/2000/svg" width="256" height="256" viewBox="0 0 256 256">
      <rect width="256" height="256" fill="white"/>
      <path d="M70 170c0-55 30-85 58
